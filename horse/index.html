<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Knight's Tour Game (V2)</title>
    <style>
        :root {
            /* Define o tamanho base para o PC */
            --square-size: 70px;
            --horse-size: 40px;
            --number-size: 24px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Usa min-height para permitir rolagem se necess√°rio */
            margin: 0;
            padding: 20px 0; /* Adiciona um pouco de espa√ßo vertical */
            background-color: #23272a;
            color: #ffffff;
            gap: 50px;
        }
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #board {
            display: grid;
            border: 3px solid #7289da;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .square {
            width: var(--square-size);
            height: var(--square-size);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--number-size);
            font-weight: bold;
            border: 1px solid #4f545c;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        .square.light { background-color: #ffffff; color: #23272a; }
        .square.dark { background-color: #99aab5; color: #ffffff; }
        .square.current::before {
            content: 'üê¥';
            font-size: var(--horse-size);
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.4));
        }
        .square.visited {
            background-color: #43b581 !important;
            color: #ffffff;
            cursor: not-allowed;
        }
        .square.visited::before { content: ''; }
        
        #controls { margin-top: 20px; text-align: center; }
        #message { font-size: 1.2em; min-height: 30px; font-weight: 500; }
        .button-group { margin-top: 15px; display: flex; gap: 10px; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        button:disabled { background-color: #526199; cursor: not-allowed; opacity: 0.6; }
        #nextLevelButton { background-color: #43b581; color: white; }
        #resetButton { background-color: #f04747; color: white; }
        #undoButton { background-color: #7289da; color: white; }

        #timer-container { font-size: 1.5em; margin-top: 20px; font-weight: bold; font-family: 'Courier New', Courier, monospace; }
        #results-container {
            padding: 20px;
            background-color: #2c2f33;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.6);
            width: 250px;
            text-align: center;
        }
        #results-container h3 { margin-top: 0; color: #7289da; }
        #results-list p {
            background-color: #4f545c;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            font-family: 'Courier New', Courier, monospace;
        }

        /* PASSO 2: A M√ÅGICA DA RESPONSIVIDADE (MEDIA QUERY) */
        @media (max-width: 768px) {
            body {
                flex-direction: column; /* Empilha os itens verticalmente */
                gap: 20px;
                padding: 10px 0;
            }
            #results-container {
                width: 90%; /* Ocupa a maior parte da largura da tela */
                order: -1; /* Move o placar para o topo */
                margin-bottom: 20px;
            }
            :root {
                /* Define tamanhos relativos √† largura da tela para o celular */
                /* O c√°lculo (90vw / boardSize) ser√° feito no JS */
                --horse-size: 8vw;
                --number-size: 4vw;
            }
            .square:hover {
                transform: none; /* Remove o efeito de hover que n√£o funciona bem no touch */
            }
            button {
                padding: 12px 15px; /* Bot√µes um pouco maiores para facilitar o toque */
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>The Knight's Tour Game</h1>
        <div id="board"></div>
        <div id="controls">
            <p id="message"></p>
            <div id="timer-container">Time: <span id="timer">00:00.00</span></div>
            <div class="button-group">
                <button id="undoButton" disabled>Undo</button>
                <button id="resetButton" disabled>Reset Level</button>
                <button id="nextLevelButton" style="display: none;">Next Level</button>
            </div>
        </div>
    </div>

    <div id="results-container">
        <h3>Results</h3>
        <div id="results-list"></div>
    </div>

    <script>
        // --- Global Variables ---
        let boardSize = 5;
        let boardState, moveCount, currentX, currentY, moveHistory;
        
        let timerInterval = null;
        let startTime = 0;
        let isTimerRunning = false;
        
        const root = document.documentElement; // Refer√™ncia para o :root do CSS
        const boardElement = document.getElementById('board');
        const messageElement = document.getElementById('message');
        const nextLevelButton = document.getElementById('nextLevelButton');
        const resetButton = document.getElementById('resetButton');
        const undoButton = document.getElementById('undoButton');
        const timerElement = document.getElementById('timer');
        const resultsList = document.getElementById('results-list');

        // --- Timer Functions ---
        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const ms = Math.floor((milliseconds % 1000) / 10);
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${ms.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            if (isTimerRunning) return;
            startTime = Date.now();
            isTimerRunning = true;
            timerInterval = setInterval(() => {
                const elapsedMs = Date.now() - startTime;
                timerElement.textContent = formatTime(elapsedMs);
            }, 51);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            return Date.now() - startTime;
        }

        function resetTimerDisplay() {
            timerElement.textContent = '00:00.00';
            startTime = 0;
        }

        // --- Game Logic Functions ---
        function resetBoard() {
            boardState = Array(boardSize).fill(null).map(() => Array(boardSize).fill(0));
            moveCount = 0; currentX = -1; currentY = -1; moveHistory = [];
            messageElement.textContent = isTimerRunning ? 'Find the next move!' : `Level ${boardSize}x${boardSize}: Click any square to begin.`;
            resetButton.disabled = !isTimerRunning;
            undoButton.disabled = !isTimerRunning;
            createBoard();
        }

        function initNewLevel() {
            if (isTimerRunning) stopTimer();
            resetTimerDisplay();
            nextLevelButton.style.display = 'none';
            resetBoard();
        }

        function createBoard() {
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;

            // PASSO 3: L√ìGICA JAVASCRIPT PARA O TAMANHO
            if (window.innerWidth <= 768) {
                // Se for tela pequena, calcula o tamanho da casa dinamicamente
                const squareSizeVW = 90 / boardSize; // Usa 90% da largura da tela, dividido pelo n√∫mero de casas
                root.style.setProperty('--square-size', `${squareSizeVW}vw`);
            } else {
                // Se for tela grande, volta para um tamanho fixo
                root.style.setProperty('--square-size', '70px');
            }

            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    const square = document.createElement('div');
                    square.classList.add('square', (i + j) % 2 === 0 ? 'light' : 'dark');
                    square.dataset.x = i; square.dataset.y = j;
                    square.addEventListener('click', handleSquareClick);
                    boardElement.appendChild(square);
                }
            }
        }

        function handleSquareClick(event) {
            const x = parseInt(event.target.dataset.x);
            const y = parseInt(event.target.dataset.y);
            if (!isTimerRunning && moveCount === 0) {
                startTimer();
            }
            messageElement.textContent = 'Find the next move!';
            if (moveCount === 0 || isValidMove(x, y)) {
                placeKnight(x, y);
                if (moveCount === boardSize * boardSize) {
                    winGame();
                }
            }
        }

        function isValidMove(nextX, nextY) {
            if (boardState[nextX][nextY] !== 0) return false;
            const dx = Math.abs(currentX - nextX);
            const dy = Math.abs(currentY - nextY);
            return (dx === 1 && dy === 2) || (dx === 2 && dy === 1);
        }

        function placeKnight(x, y) {
            if (currentX !== -1) {
                document.querySelector(`.square[data-x='${currentX}'][data-y='${currentY}']`).classList.remove('current', 'visited');
                document.querySelector(`.square[data-x='${currentX}'][data-y='${currentY}']`).classList.add('visited');
            }
            moveCount++;
            boardState[x][y] = moveCount;
            currentX = x; currentY = y;
            moveHistory.push({x, y});
            const newSquare = document.querySelector(`.square[data-x='${x}'][data-y='${y}']`);
            newSquare.textContent = moveCount;
            newSquare.classList.add('current');
            resetButton.disabled = false;
            undoButton.disabled = false;
        }
        
        function handleUndo() {
            if (moveCount <= 1) { resetBoard(); return; }
            const lastMove = moveHistory.pop();
            boardState[lastMove.x][lastMove.y] = 0;
            moveCount--;
            const lastSquare = document.querySelector(`.square[data-x='${lastMove.x}'][data-y='${lastMove.y}']`);
            lastSquare.classList.remove('visited', 'current');
            lastSquare.textContent = '';
            const prevMove = moveHistory[moveHistory.length - 1];
            currentX = prevMove.x; currentY = prevMove.y;
            const prevSquare = document.querySelector(`.square[data-x='${currentX}'][data-y='${currentY}']`);
            prevSquare.classList.remove('visited');
            prevSquare.classList.add('current');
        }
        
        function winGame() {
            const elapsedMilliseconds = stopTimer();
            const timeString = formatTime(elapsedMilliseconds);
            messageElement.textContent = `Congratulations! You completed the level in ${timeString}!`;
            const resultText = `Level ${boardSize}x${boardSize}: ${timeString}`;
            const resultElement = document.createElement('p');
            resultElement.textContent = resultText;
            resultsList.appendChild(resultElement);
            const currentSquare = document.querySelector('.current');
            if (currentSquare) { currentSquare.classList.remove('current'); currentSquare.classList.add('visited'); }
            boardSize++;
            nextLevelButton.textContent = `Proceed to Level ${boardSize}x${boardSize}`;
            nextLevelButton.style.display = 'block';
            resetButton.disabled = true;
            undoButton.disabled = true;
        }

        // Event Listeners
        nextLevelButton.addEventListener('click', initNewLevel);
        resetButton.addEventListener('click', resetBoard);
        undoButton.addEventListener('click', handleUndo);
        window.addEventListener('resize', createBoard); // Recria o tabuleiro se a tela mudar de tamanho

        // --- Start the Game ---
        initNewLevel();
    </script>
</body>

</html>
